<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>OCAT framework for the quality control of R code</title>
  <meta name="description" content="OCAT framework for the quality control of R code" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="OCAT framework for the quality control of R code" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="OCAT framework for the quality control of R code" />
  
  
  

<meta name="author" content="Observatory &amp; Cancer Analysis Team, version 0b, August 2021" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="qc_guidance.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path=""><a href="#introduction"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path=""><a href="#development-of-the-qc-framework"><i class="fa fa-check"></i><b>2</b> Development of the QC framework</a><ul>
<li class="chapter" data-level="2.1" data-path=""><a href="#requirements"><i class="fa fa-check"></i><b>2.1</b> Requirements</a></li>
<li class="chapter" data-level="2.2" data-path=""><a href="#approach-and-outcome"><i class="fa fa-check"></i><b>2.2</b> Approach and outcome</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path=""><a href="#three-scenarios-for-quality-control-of-r-code"><i class="fa fa-check"></i><b>3</b> Three scenarios for quality control of R code</a><ul>
<li class="chapter" data-level="3.1" data-path=""><a href="#scenario-1-new-r-code-or-raps-being-set-up-for-the-first-time-by-ocat"><i class="fa fa-check"></i><b>3.1</b> Scenario 1: New R code or RAPs being set up for the first time by OCAT</a></li>
<li class="chapter" data-level="3.2" data-path=""><a href="#scenario-2-update-of-r-code-or-raps-set-up-previously-by-ocat"><i class="fa fa-check"></i><b>3.2</b> Scenario 2: Update of R code or RAPs set up previously by OCAT</a></li>
<li class="chapter" data-level="3.3" data-path=""><a href="#scenario-3-the-future---development-of-more-advanced-methods"><i class="fa fa-check"></i><b>3.3</b> Scenario 3: The future - development of more advanced methods</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path=""><a href="#deciding-what-kind-of-qc-to-do-in-r-and-how-to-carry-it-out"><i class="fa fa-check"></i><b>4</b> Deciding what kind of QC to do in R, and how to carry it out</a><ul>
<li class="chapter" data-level="4.1" data-path=""><a href="#scenario-1-further-detail"><i class="fa fa-check"></i><b>4.1</b> Scenario 1: further detail</a></li>
<li class="chapter" data-level="4.2" data-path=""><a href="#scenario-2-further-detail"><i class="fa fa-check"></i><b>4.2</b> Scenario 2: further detail</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path=""><a href="#QC-template"><i class="fa fa-check"></i><b>5</b> QC templates</a><ul>
<li class="chapter" data-level="5.1" data-path=""><a href="#readme"><i class="fa fa-check"></i><b>5.1</b> Readme</a></li>
<li class="chapter" data-level="5.2" data-path=""><a href="#scenario-1"><i class="fa fa-check"></i><b>5.2</b> Scenario 1</a></li>
<li class="chapter" data-level="5.3" data-path=""><a href="#scenario-2"><i class="fa fa-check"></i><b>5.3</b> Scenario 2</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path=""><a href="#implementation-and-feedback"><i class="fa fa-check"></i><b>6</b> Implementation and feedback</a><ul>
<li class="chapter" data-level="6.1" data-path=""><a href="#advice-and-feedback"><i class="fa fa-check"></i><b>6.1</b> Advice and feedback</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">OCAT framework for the quality control of R code</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">OCAT framework for the quality control of R code</h1>
<p class="author"><em>Observatory &amp; Cancer Analysis Team, version 0b, August 2021</em></p>
</div>
<!-- You need version of R > 3.6.3 and bookdown installed to generate a book -->
<!--# OCAT Style Guide for R Code-->
<!-- Note: File must start with h2 (##) as this Introduction sits below the main OCAT title in the skeleton rmd. -->
<p>To jump straight to the QC templates, click <a href="#QC-template">here</a></p>
<div id="introduction" class="section level1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>It was recognised that a new framework is required to formalise quality control (QC) of R code and Reproducible Analytical Pipelines (RAPs) produced within the Observatory &amp; Cancer Analysis Team (OCAT), and to outline how more advanced QC methods might be developed for RAPs in the future.</p>
<p>Over the last 3 years, OCAT has begun to conduct analysis in R and develop RAPs in order to produce health intelligence publications more efficiently. Whereas traditional approaches have used multiple pieces of proprietary software to extract, manipulate and present data, an RAP uses a single piece of open source software to perform these tasks. For example, the origianl Child Measurement Programme analysis involved a complex process of moving data between SQL, Stata and Excel, with presentation of the charts in interactive Excel spreadsheet. This process was then turned into an RAP, with all stages carried out in R: extracting the data from the SQL database, data manipulation, statistical analysis, and then presenting the charts in an R/shiny dashboard. The following diagram depicts the original process compared to the RAP:</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-1"></span>
<img src="CMP_combined.png" alt="CMP workflow: original process compared to Reproducible Analytical Pipeline using R" width="95%" />
<p class="caption">
Figure 1.1: CMP workflow: original process compared to Reproducible Analytical Pipeline using R
</p>
</div>
<p>These developments followed the discovery of a Government Digital Service <a href="https://dataingovernment.blog.gov.uk/2017/03/27/reproducible-analytical-pipeline/">blog</a> in which the use of RAPs is further explained. The key benefits are as follows:</p>
<ul>
<li>Greater efficiency, since the process is programmed using code rather than carried out with point-and-click software;</li>
<li>Greater reproducibility, since the program provides a clear audit trail of the processing and analysis that has been carried out;</li>
<li>Greater transparency, since the program can easily be shared with others, potentially online;</li>
<li>Improved accuracy, because rather than copying data between multiple pieces of software, a single programming language can complete the whole process from data extraction to publication;</li>
<li>Reduced costs, because the software used is open-source.</li>
</ul>
<hr>
<!-- Note: File must start with h1 (#) as this forms a new chapter. -->
</div>
<div id="development-of-the-qc-framework" class="section level1">
<h1><span class="header-section-number">2</span> Development of the QC framework</h1>
<div id="requirements" class="section level2">
<h2><span class="header-section-number">2.1</span> Requirements</h2>
<p>Traditional methods of producing health intelligence publications have used traditional methods of quality control, largely documented using Microsoft Excel. These methods of quality control do not apply neatly to RAPs.</p>
<p>However, we may also not be ready for the development of more advanced “unit testing” approaches, as described in the blog linked within the introduction.</p>
<p>A quality control framework is therefore required now, which will cater for the current context and levels of knowledge and skills within the team, whilst pointing the way to the development of more advanced methods in the future.</p>
</div>
<div id="approach-and-outcome" class="section level2">
<h2><span class="header-section-number">2.2</span> Approach and outcome</h2>
<p>With these requirements in mind, meetings were arranged with the following groups, to help inform the development of the new framework:</p>
<ul>
<li>OCAT colleagues who have recently project managed major pieces of work carried out in R (discussions captured in this file: \\ryt6bsrvfil0002\observatory\Health Intelligence\Method\Quality Assurance\R\20200204_QC-of-RAPs_DiscussionWithProjectLeads_HC_v0a.docx)</li>
<li>Public Health England data science team (Seb Fox and Julian Flowers)</li>
<li>Information Services Division (ISD) Scotland, now Public Health Scotland (Ciara Gribben and David Caldwell</li>
</ul>
<p>Having carried out these meetings, the following three scenarios emerged, each of which will require a different approach to quality control:</p>
<ol>
<li>
New R code or RAPs being set up for the first time by OCAT
<li>
Update of R code or RAPs set up previously by OCAT
<li>
The future - development of more advanced methods
</ol>
<hr>
<!-- Note: File must start with h1 (#) as this forms a new chapter. -->
</div>
</div>
<div id="three-scenarios-for-quality-control-of-r-code" class="section level1">
<h1><span class="header-section-number">3</span> Three scenarios for quality control of R code</h1>
<div id="scenario-1-new-r-code-or-raps-being-set-up-for-the-first-time-by-ocat" class="section level2">
<h2><span class="header-section-number">3.1</span> Scenario 1: New R code or RAPs being set up for the first time by OCAT</h2>
<p>According to OCAT colleagues, there are broad similarities in their approach to QC in R in this scenario so far, with one of the following options being chosen:</p>
<ul>
<li>Analysis produced by an R script is checked against analysis produced using an ‘old’ method, e.g. SQL or Stata</li>
<li>Analysis produced by an R script is checked against published figures for that indicator</li>
<li>Two different analysts produce the same analysis using independently-written R scripts</li>
</ul>
<p>There does not appear to be any reason to restrict these options at the moment. However, there is a need for a consistent set of questions to be used for the QC, as there is when QC’ing an Excel file, and a way of recording these to provide an audit trail.</p>
</div>
<div id="scenario-2-update-of-r-code-or-raps-set-up-previously-by-ocat" class="section level2">
<h2><span class="header-section-number">3.2</span> Scenario 2: Update of R code or RAPs set up previously by OCAT</h2>
<p>We were advised by PHE colleagues that they do not continually QC updates of RAPs using the methods outlined in scenario 1. Rather, they employ a three-step process:</p>
<ol style="list-style-type: decimal">
<li>Write code to check the data coming into the RAP – e.g. has the format of any of the data changed, or are there any out-of-range values?</li>
<li>A colleague carries out a code review – do all the functions do what they are intended to do?</li>
<li>The results are sense-checked.</li>
</ol>
<p>This appears to be a sensible quality control process to adopt within OCAT for this scenario.</p>
</div>
<div id="scenario-3-the-future---development-of-more-advanced-methods" class="section level2">
<h2><span class="header-section-number">3.3</span> Scenario 3: The future - development of more advanced methods</h2>
<p>Colleagues from ISD Scotland presented their <a href="https://www.isdscotland.org/About-ISD/Methodologies/_docs/Reproducible_Analytical_Pipelines_paper_v1.4.pdf">guidance on RAPs</a> to OCAT. This includes a helpful table (below) showing ‘code maturity’, where RAPs are classified on a scale from 1 to 7, with level 7 representing the highest level of maturity. From level 5, quality assurance is automated and unit testing is carried out on functions (to check they are doing what they are meant to be doing).
Currently, in OCAT, we have achieved elements of levels 1 to 4, but without version control of code using Git, which is currently being investigated.</p>
<p>A key aim for data science within OCAT is therefore to develop the maturity of our code and implement automated quality control of data and unit testing, as well as version control using Git. This will push us on to levels 5 to 7 of code maturity. Automated quality assurance, i.e. of data coming into an RAP, is already being explored by the Covid Recovery Profile team.</p>
<p>Achieving these aims requires the right project with an appropriate deadline, plus some staff development time, to implement these new techniques using ‘real world’ projects.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-2"></span>
<img src="isd_scotland_code_maturity.PNG" alt="Code maturity table (ISD Scotland)" width="100%" />
<p class="caption">
Figure 3.1: Code maturity table (ISD Scotland)
</p>
</div>
<hr>
<!-- Note: File must start with h2 (##) as this forms a new tab. All other headings must be level 3 (###) or higher -->
</div>
</div>
<div id="deciding-what-kind-of-qc-to-do-in-r-and-how-to-carry-it-out" class="section level1">
<h1><span class="header-section-number">4</span> Deciding what kind of QC to do in R, and how to carry it out</h1>
<p>This flowchart is provided to help with deciding what kind of QC to carry out.
The two scenarios described in section 3 are shown in the flowchart. Underneath
the flowchart, further detail is provided on the different QC methods shown.</p>
<p><img src="qc_flow_chart_v0b.jpg" width="1200" /></p>
<div id="scenario-1-further-detail" class="section level2">
<h2><span class="header-section-number">4.1</span> Scenario 1: further detail</h2>
<ol style="list-style-type: decimal">
<li>Compare to ‘old method’ e.g. SQL, Excel, Stata<br />
This method of QC is more likely to be used where there is an existing piece of
work that has been done using the ‘old method’ e.g. SQL, Excel, Stata. For example, a piece of
survey analysis may have been carried out using Stata and Excel a couple of years
ago, and so the easiest way to QC the new R script is to make it run the same analysis
on the same data as the Stata and Excel piece of work, and compare the results. If a
piece of work using the ‘old method’ has not been carried out previously to compare to,
then it is probably best to write an independent piece of R code and then compare the
results (see 3 below). This will provide an opportunity for the QCing analyst to
develop their R skills.</li>
<li>Compare to published figures
If the results of a new R script compare well with published figures, e.g. for
a number of different age-standardised mortality rates, then it can reasonably
be assumed that the R script is working well and the QC can be passed. However,
it would still be necessary to go through the script and complete the QC checks
listed in section 5.2.<br />
</li>
<li>Write your own R code and then compare the results<br />
Here, the QCing analyst writes an independent piece of R code to produce the same
statistics. This is preferred to the QCing analyst simply checking through the
analyst’s code, because it is all too easy to read someone else’s code and think it
looks OK, when in fact there are hidden issues that would only come to light when
writing independent code. This can be time-consuming, but provides an
opportunity to develop R skills.</li>
</ol>
</div>
<div id="scenario-2-further-detail" class="section level2">
<h2><span class="header-section-number">4.2</span> Scenario 2: further detail</h2>
<ol style="list-style-type: decimal">
<li>Input: check data coming in<br />
The aim of this step is to check that data coming into the pipeline, e.g. from
a SQL database or a survey dataset, is in a fit state to be run through
the R script. For example:</li>
</ol>
<ul>
<li>Is the number of rows within the right ballpark, or is a load of data missing?</li>
<li>Are there any missing values?</li>
<li>Have any of the data types changes, e.g. a column that was previously character
now coming in as a factor type?</li>
</ul>
<p>These checks are required to prevent the R script from producing figures that
might appear OK, but are actually erroneous due to changes in the underlying data.
Ideally, checks should be automated as much as possible within an R script, to
make the process more efficient. For example, the Covid Recovery Profile uses
functions to check incoming data, so that the analyst running the script can
simply look through the results of the checks, rather than having to run each
check manually.</p>
<ol start="2" style="list-style-type: decimal">
<li><p>Review the code<br />
As described in section 5.3, the aim of the code review is to check that the code
is doing what it is meant to do. If the code was only QC’d recently, and
is now being run to update the indicators, then a code review is not required.
However, if six months to a year has passed since the code was originally QC’d,
it is suggested that the QCing analyst carries out a code review, as described
in section 5.3.<br />
Note that some sections of the code may have been improved, e.g. repetitive code
turned into a function, or new code may have been added since the original full
QC of the script. If this is the case then check whether these amendments have
been fully QC’d previously, and if not then do so at this point.</p></li>
<li><p>Sense check the results<br />
The QCing analyst should check that trends look OK, and compare well to published
figures or previous analyses carried out within OCAT. See prompts within
section 5.3. This acts as a final check, and in the past has been known to uncover
errors within an analysis that have passed through QC.</p></li>
</ol>
<hr>
</div>
</div>
<div id="QC-template" class="section level1">
<h1><span class="header-section-number">5</span> QC templates</h1>
<p>This section provides template text for you to paste into the top of
your R script and then use to document the QC. Please note that these templates can be adjusted according to need, although this would generally be about adding or amending, rather than removing a whole load of checks ;-)<br />
Also, if your project is large and you are QC’ing an analysis that is produced by a number of different R scripts, it may be best to have a separate over-arching ‘QC script’ which just holds the Readme / Audit trail / QC questions, rather than trying to put these at the top of each R script.</p>
<p>When you hover over the template text, the ‘Copy’ button will appear at the top-right of the window. Use this to copy the text into your R script.</p>
<p>Template text is provided for the following.</p>
<ul>
<li><p>Readme - this is the metadata that records what you did, what data you used, etc. This is vital information to enable other analysts to understand what was done. The Readme section should be included once for <strong>every analysis</strong>, whether that’s at the top of the R script used to the produce the analysis, or in a separate over-arching ‘QC script’ for larger projects that use a number of different R scripts to produce the analysis.</p></li>
<li>Scenario 1:
<ul>
<li>Audit trail</li>
<li>Quality control questions</li>
</ul></li>
<li>Scenario 2:
<ul>
<li>Audit trail</li>
<li>Quality control questions</li>
</ul></li>
</ul>
<div id="readme" class="section level2">
<h2><span class="header-section-number">5.1</span> Readme</h2>
<p>Notes for use:</p>
<ul>
<li><strong>Data source</strong> should include numerator and denominator data</li>
<li><strong>Demography</strong> means the sex and age of the population included in the analysis</li>
<li><strong>Statistics</strong> means counts, crude rates, EASR, confidence intervals etc.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># README =======================================================================</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="co"># </span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co"># Script author:</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co"># Date started:</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co"># R version used:</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co"># What question is being answered?</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co">#</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co"># Topic:</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co"># Subject:</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co"># Data source:</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co"># Geography:</span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="co"># Period:</span></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="co"># Demography:</span></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="co"># Statistics:</span></a>
<a class="sourceLine" id="cb1-15" title="15"><span class="co"># </span></a>
<a class="sourceLine" id="cb1-16" title="16"><span class="co"># Notes:</span></a>
<a class="sourceLine" id="cb1-17" title="17"><span class="co"># References, e.g. links to any online R help used:</span></a>
<a class="sourceLine" id="cb1-18" title="18"><span class="co"># </span></a>
<a class="sourceLine" id="cb1-19" title="19"><span class="co"># ==============================================================================</span></a></code></pre></div>
</div>
<div id="scenario-1" class="section level2">
<h2><span class="header-section-number">5.2</span> Scenario 1</h2>
<p>When the analysis you are QC’ing corresponds to Scenario 1, i.e. some R code that has not been QC’d before, use the following audit trail and QC checks.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># AUDIT TRAIL ==================================================================</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="co"># </span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="co"># Indicator(s) being QC’d:</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">#   </span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co"># Date: </span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="co"># Name of QCer:</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co"># Time taken (approx):</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="co">#   </span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co"># Which of the following methods were used?  (1, 2, or 3)</span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="co"># 1. Production of indicators in R versus production using an ‘old’ method,</span></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="co">#         e.g. SQL or Stata</span></a>
<a class="sourceLine" id="cb2-12" title="12"><span class="co"># 2. Production of indicators in R versus published figures for that indicator</span></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="co"># 3. Production of indicators in R by two different analysts</span></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="co"># If none of these methods were used, please indicate how the indicator </span></a>
<a class="sourceLine" id="cb2-15" title="15"><span class="co"># was QC’d:</span></a>
<a class="sourceLine" id="cb2-16" title="16"><span class="co">#       </span></a>
<a class="sourceLine" id="cb2-17" title="17"><span class="co"># Description of what files were used to carry out the QC, including file paths:</span></a>
<a class="sourceLine" id="cb2-18" title="18"><span class="co">#</span></a>
<a class="sourceLine" id="cb2-19" title="19"><span class="co"># What were the results of the QC, i.e. did the two sets of figures match?</span></a>
<a class="sourceLine" id="cb2-20" title="20"><span class="co">#</span></a>
<a class="sourceLine" id="cb2-21" title="21"><span class="co"># If not, what steps were required to reconcile them, at least within reasonable</span></a>
<a class="sourceLine" id="cb2-22" title="22"><span class="co"># limits?</span></a>
<a class="sourceLine" id="cb2-23" title="23"><span class="co">#</span></a>
<a class="sourceLine" id="cb2-24" title="24"><span class="co"># What changes were made following the QC checks?</span></a>
<a class="sourceLine" id="cb2-25" title="25"><span class="co">#</span></a>
<a class="sourceLine" id="cb2-26" title="26"><span class="co"># Other notes:</span></a>
<a class="sourceLine" id="cb2-27" title="27"><span class="co"># </span></a>
<a class="sourceLine" id="cb2-28" title="28"><span class="co"># ==============================================================================</span></a>
<a class="sourceLine" id="cb2-29" title="29"></a>
<a class="sourceLine" id="cb2-30" title="30"></a>
<a class="sourceLine" id="cb2-31" title="31"></a>
<a class="sourceLine" id="cb2-32" title="32"><span class="co"># QC checks ====================================================================</span></a>
<a class="sourceLine" id="cb2-33" title="33"><span class="co"># (checks of method and outputs, further to comparing the two sets of figures</span></a>
<a class="sourceLine" id="cb2-34" title="34"><span class="co">#  using method 1, 2 or 3)</span></a>
<a class="sourceLine" id="cb2-35" title="35"><span class="co"># a. Does the analysis answer the question being asked?</span></a>
<a class="sourceLine" id="cb2-36" title="36"><span class="co">#</span></a>
<a class="sourceLine" id="cb2-37" title="37"><span class="co"># b. Metadata:</span></a>
<a class="sourceLine" id="cb2-38" title="38"><span class="co"># Has the Readme info been included at the top of the script?</span></a>
<a class="sourceLine" id="cb2-39" title="39"><span class="co">#</span></a>
<a class="sourceLine" id="cb2-40" title="40"><span class="co"># Is it clear where the data comes from?</span></a>
<a class="sourceLine" id="cb2-41" title="41"><span class="co">#</span></a>
<a class="sourceLine" id="cb2-42" title="42"><span class="co"># Have the caveats around the data sources been taken into account within the </span></a>
<a class="sourceLine" id="cb2-43" title="43"><span class="co"># analysis, and reported within the Readme sheet or comments in the R script? </span></a>
<a class="sourceLine" id="cb2-44" title="44"><span class="co"># E.g. missing diagnosis codes when using PEDW.</span></a>
<a class="sourceLine" id="cb2-45" title="45"><span class="co">#</span></a>
<a class="sourceLine" id="cb2-46" title="46"><span class="co"># c. Information governance</span></a>
<a class="sourceLine" id="cb2-47" title="47"><span class="co"># Are there any information governance concerns, e.g. small numbers?</span></a>
<a class="sourceLine" id="cb2-48" title="48"><span class="co">#</span></a>
<a class="sourceLine" id="cb2-49" title="49"><span class="co"># d. Check numerator and denominator data</span></a>
<a class="sourceLine" id="cb2-50" title="50"><span class="co"># Have the correct ICD-10 or OPCS codes been used to extract the numerator data?</span></a>
<a class="sourceLine" id="cb2-51" title="51"><span class="co">#</span></a>
<a class="sourceLine" id="cb2-52" title="52"><span class="co"># Does the denominator match the numerator in age/sex, time period and area?</span></a>
<a class="sourceLine" id="cb2-53" title="53"><span class="co">#</span></a>
<a class="sourceLine" id="cb2-54" title="54"><span class="co"># e. Check statistical methods</span></a>
<a class="sourceLine" id="cb2-55" title="55"><span class="co"># Correct decision made to include or omit confidence intervals?</span></a>
<a class="sourceLine" id="cb2-56" title="56"><span class="co">#</span></a>
<a class="sourceLine" id="cb2-57" title="57"><span class="co"># Correct method used to calculate confidence intervals?</span></a>
<a class="sourceLine" id="cb2-58" title="58"><span class="co">#</span></a>
<a class="sourceLine" id="cb2-59" title="59"><span class="co"># Correct method used to test statistical significance?</span></a>
<a class="sourceLine" id="cb2-60" title="60"><span class="co">#</span></a>
<a class="sourceLine" id="cb2-61" title="61"><span class="co"># Appropriate use of crude / age-standardised rates?</span></a>
<a class="sourceLine" id="cb2-62" title="62"><span class="co">#</span></a>
<a class="sourceLine" id="cb2-63" title="63"><span class="co"># Correct weightings used for direct standardisation?</span></a>
<a class="sourceLine" id="cb2-64" title="64"><span class="co">#</span></a>
<a class="sourceLine" id="cb2-65" title="65"><span class="co"># Comparator (e.g. Wales average) provided as appropriate?</span></a>
<a class="sourceLine" id="cb2-66" title="66"><span class="co">#</span></a>
<a class="sourceLine" id="cb2-67" title="67"><span class="co"># f. Carry out a ‘sense check’ of the results:</span></a>
<a class="sourceLine" id="cb2-68" title="68"><span class="co"># 1. Do they appear reasonable?  Are they much higher or lower than in </span></a>
<a class="sourceLine" id="cb2-69" title="69"><span class="co">#    previous years?</span></a>
<a class="sourceLine" id="cb2-70" title="70"><span class="co"># 2. How do they compare with published figures?</span></a>
<a class="sourceLine" id="cb2-71" title="71"><span class="co">#</span></a>
<a class="sourceLine" id="cb2-72" title="72"><span class="co"># g. Check table and chart formatting</span></a>
<a class="sourceLine" id="cb2-73" title="73"><span class="co"># Is the table formatting satisfactory?</span></a>
<a class="sourceLine" id="cb2-74" title="74"><span class="co"># Is the chart formatting satisfactory?</span></a>
<a class="sourceLine" id="cb2-75" title="75"></a>
<a class="sourceLine" id="cb2-76" title="76"><span class="co"># h. Does the style of the code, and the naming of files and objects,</span></a>
<a class="sourceLine" id="cb2-77" title="77"><span class="co">#    conform to the OCAT style guide?</span></a>
<a class="sourceLine" id="cb2-78" title="78"></a>
<a class="sourceLine" id="cb2-79" title="79"><span class="co"># ==============================================================================</span></a></code></pre></div>
</div>
<div id="scenario-2" class="section level2">
<h2><span class="header-section-number">5.3</span> Scenario 2</h2>
<p>When the analysis you are QC’ing corresponds to Scenario 2, i.e. some R code that has been QC’d before and is now being run again, use the following audit trail and QC checks.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># AUDIT TRAIL ==================================================================</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="co"># </span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="co"># Indicator(s) being QC’d:</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co">#   </span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="co"># Date: </span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="co"># Name of QCer:</span></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="co"># Time taken (approx):</span></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="co">#   </span></a>
<a class="sourceLine" id="cb3-9" title="9"><span class="co"># Results of the QC checks should be documented in the &#39;QC checks&#39; section </span></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="co"># below.</span></a>
<a class="sourceLine" id="cb3-11" title="11"><span class="co">#</span></a>
<a class="sourceLine" id="cb3-12" title="12"><span class="co"># What changes were made following the QC checks?</span></a>
<a class="sourceLine" id="cb3-13" title="13"><span class="co">#</span></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="co"># Other notes:</span></a>
<a class="sourceLine" id="cb3-15" title="15"><span class="co"># </span></a>
<a class="sourceLine" id="cb3-16" title="16"><span class="co"># ==============================================================================</span></a>
<a class="sourceLine" id="cb3-17" title="17"></a>
<a class="sourceLine" id="cb3-18" title="18"></a>
<a class="sourceLine" id="cb3-19" title="19"></a>
<a class="sourceLine" id="cb3-20" title="20"><span class="co"># QC checks ====================================================================</span></a>
<a class="sourceLine" id="cb3-21" title="21"><span class="co">#</span></a>
<a class="sourceLine" id="cb3-22" title="22"><span class="co"># 1. Has code been written to check the data coming into the pipeline, </span></a>
<a class="sourceLine" id="cb3-23" title="23"><span class="co">#    for example:</span></a>
<a class="sourceLine" id="cb3-24" title="24"><span class="co">#    a. Are there any missing values?</span></a>
<a class="sourceLine" id="cb3-25" title="25"><span class="co">#    b. Are any values ‘out of range’, e.g. implausible age, height or weight?</span></a>
<a class="sourceLine" id="cb3-26" title="26"><span class="co">#    c. Are there any differences in how the source data is formatted, e.g. are </span></a>
<a class="sourceLine" id="cb3-27" title="27"><span class="co">#     the numbers formatted as integer in one year and then decimal in another </span></a>
<a class="sourceLine" id="cb3-28" title="28"><span class="co">#     year?</span></a>
<a class="sourceLine" id="cb3-29" title="29"></a>
<a class="sourceLine" id="cb3-30" title="30"><span class="co"># 2. Is a code review is required, e.g. if a considerable time has passed since the</span></a>
<a class="sourceLine" id="cb3-31" title="31"><span class="co">#    code was first written and QC’d?  If a code review is required, make a </span></a>
<a class="sourceLine" id="cb3-32" title="32"><span class="co">#    copy of the original script, and make comments within it wherever you think</span></a>
<a class="sourceLine" id="cb3-33" title="33"><span class="co">#    something could be improved, using the questions below as a prompt.</span></a>
<a class="sourceLine" id="cb3-34" title="34"><span class="co">#    Then answer the questions below:</span></a>
<a class="sourceLine" id="cb3-35" title="35"><span class="co">#    </span></a>
<a class="sourceLine" id="cb3-36" title="36"><span class="co">#    Does the overall process followed by the code still make sense?</span></a>
<a class="sourceLine" id="cb3-37" title="37"><span class="co">#</span></a>
<a class="sourceLine" id="cb3-38" title="38"><span class="co">#    Does each section of the code still do what it was intended to do?</span></a>
<a class="sourceLine" id="cb3-39" title="39"><span class="co">#</span></a>
<a class="sourceLine" id="cb3-40" title="40"><span class="co">#    Are there any improvements that you think should be made, e.g.</span></a>
<a class="sourceLine" id="cb3-41" title="41"><span class="co">#       a) Where code is not giving the right answer (an error)</span></a>
<a class="sourceLine" id="cb3-42" title="42"><span class="co">#       b) Where code could be written better (style or efficiency)</span></a>
<a class="sourceLine" id="cb3-43" title="43"><span class="co"># </span></a>
<a class="sourceLine" id="cb3-44" title="44"><span class="co"># 3.    Carry out a ‘sense check’ of the results:</span></a>
<a class="sourceLine" id="cb3-45" title="45"><span class="co">#       a) Do they appear reasonable?  e.g. do trends look feasible; are the figures</span></a>
<a class="sourceLine" id="cb3-46" title="46"><span class="co">#          much higher or lower than in previous years? </span></a>
<a class="sourceLine" id="cb3-47" title="47"><span class="co">#       b) Do they compare well with published figures, where available, or with</span></a>
<a class="sourceLine" id="cb3-48" title="48"><span class="co">#          figures previously produced by OCAT?</span></a>
<a class="sourceLine" id="cb3-49" title="49"><span class="co">#</span></a>
<a class="sourceLine" id="cb3-50" title="50"><span class="co"># ==============================================================================</span></a></code></pre></div>
<hr>
</div>
</div>
<div id="implementation-and-feedback" class="section level1">
<h1><span class="header-section-number">6</span> Implementation and feedback</h1>
<p>Different projects carried out in R are likely to have slightly different requirements,
so the process described within this framework is likely to need tweaking to suit
those particular needs. For the Covid Recovery Profile, for example, the project
manager helpfully produced a standalone QC process document, built upon the
principles outlined within this document. For some projects, where many scripts
are used to produce some complex analysis, it might be better to have a separate
script to document the checks listed in section 5, rather than having checks listed
at the start of every script.</p>
<p>Given that our use of R is constantly evolving, this framework will need to be treated
as a ‘live’ document and updated regularly.</p>
<div id="advice-and-feedback" class="section level2">
<h2><span class="header-section-number">6.1</span> Advice and feedback</h2>
<p>Please ask for advice with implementing this framework via the ‘R help and news’ channel or
by approaching one of the R Champions.</p>
<p>Feedback would be welcomed so that the framework can be further developed.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
},
"search": false
});
});
</script>

</body>

</html>
